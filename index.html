<!DOCTYPE html>
<html>
<head>
	<meta content='text/html;charset=UTF-8' http-equiv='content-type' />
	<title>Read Share Thumbs Up</title>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js"></script>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		var RSTUModule = (function() {
			var feedUrls = [];
		
			var myModule = {};
			
			myModule.AddFeed = function(feedUrl) {
				feedUrls.push(feedUrl);
				
				var feed = new google.feeds.Feed(feedUrl);
				feed.load(function(result) {
					if (!result.error) {
						var feedsContainer = document.getElementById("feedList");
						var feedElement = document.createElement("li");
						var feedTitleElement = document.createElement("span");
						feedTitleElement.className = "feedTitle";
						feedTitleElement.appendChild(document.createTextNode(result.feed.title));
						feedElement.appendChild(feedTitleElement);
						feedsContainer.appendChild(feedElement);
						$(feedElement).data('feedUrl', feedUrl);
					}
				});				
			};
			
			var showFeedArticles = function(feedTitleElement) {
				var feedRootElement = feedTitleElement.parentNode;
				var feedUrl = $(feedRootElement).data('feedUrl');
				var feed = new google.feeds.Feed(feedUrl);
				feed.load(function(result) {
					if (!result.error) {
						var entryListElement = document.createElement("ul");
						for (var i = 0; i < result.feed.entries.length; i++) {
							var entry = result.feed.entries[i];
							
							var entryElement = document.createElement("li");
							entryElement.className = "entryRoot";
							var entryTitleElement = document.createElement("span");
							entryTitleElement.className = "articleTitle";
							entryTitleElement.appendChild(document.createTextNode(entry.title));							
							$(entryElement).data('articleIndex', i);
							entryElement.appendChild(entryTitleElement);
							entryListElement.appendChild(entryElement);
						}
						feedRootElement.appendChild(entryListElement);
					}
				});
			};
			
			var loadAndShowArticleContent = function(articleTitleElement) {
				var articleRootElement = articleTitleElement.parentNode;
				var feedUrl = $(articleRootElement).parent().parent().data('feedUrl');
				var i = $(articleRootElement).data('articleIndex');
				var feed = new google.feeds.Feed(feedUrl);
				feed.load(function(result) {
					if (!result.error) {
						var entryContentElement = document.createElement("div");
						entryContentElement.className = "articleContent";
						entryContentElement.innerHTML = result.feed.entries[i].content;
						entryContentElement.setAttribute('style', 'display: none;');						
						articleRootElement.appendChild(entryContentElement);						
						$(entryContentElement).toggle('blind', {}, 500);
						$(articleRootElement).data('loaded', true);
					}
				});
			};
			
			myModule.Initialize = function() {
				$(document).ready(function() {
					$(document).on('click','.articleTitle', function() {
						var articleRoot = this.parentNode;
						var loaded = $(articleRoot).data('loaded');
						if (loaded) {
							$(articleRoot).find('.articleContent').toggle('blind', {}, 500);
						} else {
							loadAndShowArticleContent(this);
						}
					});
					$(document).on('click', '.feedTitle', function() {
						showFeedArticles(this);
					});
					

				});
			};
			
			return myModule;
		}());
		
		RSTUModule.Initialize();
	</script>
	<script type="text/javascript">
			google.load("feeds", "1");

			function initialize() {

			return;
			}
			google.setOnLoadCallback(initialize);
			
			$(document).ready(function() {
				$('#addButton').click(function() {
					RSTUModule.AddFeed($('#addBox').val());					
				});
			});
	</script>

</head>
<body>
	<h1>Read Share Thumbs Up</h1>
	<h2>The Minimalist RSS Reader</h2>
	<div id="controls">
		<input id="addBox" type="text" />
		<input id="addButton" type="button" value="Add Feed" />
		
	</div>
	<ul id="feedList">
	</ul>
</body>
</html>